"use strict";var googleMap=googleMap||{},google=google;googleMap.init=function(){this.apiUrl="http://localhost:3000/api",this.$main=$("main"),$(".home").on("click",this.homepage.bind(this)),$(".register").on("click",this.register.bind(this)),$(".login").on("click",this.login.bind(this)),$(".logout").on("click",this.logout.bind(this)),$(".map").on("click",this.mapSetup.bind(this)),this.$main.on("submit","form",this.handleForm),this.getToken()?this.loggedInState():this.loggedOutState()},googleMap.loggedInState=function(){$(".loggedIn").show(),$(".loggedOut").hide(),this.mapSetup()},googleMap.loggedOutState=function(){$(".loggedIn").hide(),$(".loggedOut").show(),this.homepage()},googleMap.homepage=function(){$("header h1").hide(),this.$main.html('\n    <img src="/images/kraken.gif" class="kraken">\n    <h2>Desert Islands For Deserters</h2>\n    <p><h3>Islands have long held mystique for the human psyche, particularly when most of them were undiscovered. Nowadays, our interconnectivity makes it seem like there are few frontiers left to excite our imagination in the same way. However, there are two million uninhabited islands strewn in our rivers, streams and oceans. Our app covers a mere thirty of them. And even within our small sample size,  youâ€™ll find that the reasons they remain deserted are manifold. Some house wondrous, delicate ecosystems not found anywhere else in the world. Others are more sinister in nature, keeping settlers at bay with treacherous terrain, bad weather and the occasional curse. Regardless, the intrepid adventurer in you will hardly be able to resist their siren call. Just be sure not to stray too far from familiar shores or you too may be lost to the annals of time.</h3></p>\n    ')},googleMap.register=function(e){e&&e.preventDefault(),this.$main.html('\n      <h2>Register</h2>\n      <form method="post" action="/register">\n      <div class="form-group">\n      <input class="form-control" type="text" name="user[username]" placeholder="Username">\n      </div>\n      <div class="form-group">\n      <input class="form-control" type="email" name="user[email]" placeholder="Email">\n      </div>\n      <div class="form-group">\n      <input class="form-control" type="password" name="user[password]" placeholder="Password">\n      </div>\n      <div class="form-group">\n      <input class="form-control" type="password" name="user[passwordConfirmation]" placeholder="Password Confirmation">\n      </div>\n      <input class="btn btn-primary" type="submit" value="Register">\n      </form>\n      ')},googleMap.login=function(e){e.preventDefault(),this.$main.html('\n        <section class="container">\n        <h2>Login</h2>\n        <form method="post" action="/login">\n        <div class="form-group">\n        <input class="form-control" type="email" name="email" placeholder="Email">\n        </div>\n        <div class="form-group">\n        <input class="form-control" type="password" name="password" placeholder="Password">\n        </div>\n        <input class="btn btn-primary" type="submit" value="Login">\n        </form>\n        </section>\n        ')},googleMap.logout=function(e){e.preventDefault(),this.removeToken(),this.loggedOutState()},googleMap.handleForm=function(){event.preventDefault();var e=""+googleMap.apiUrl+$(this).attr("action"),t=$(this).attr("method"),o=$(this).serialize();return googleMap.ajaxRequest(e,t,o,function(e){e.token&&googleMap.setToken(e.token),googleMap.loggedInState()})},googleMap.ajaxRequest=function(e,t,o,i){return $.ajax({url:e,method:t,data:o,beforeSend:this.setRequestHeader.bind(this)}).done(i).fail(function(e){console.log(e)})},googleMap.setRequestHeader=function(e){return e.setRequestHeader("Authorization","Bearer "+this.getToken())},googleMap.setToken=function(e){return window.localStorage.setItem("token",e)},googleMap.getToken=function(){return window.localStorage.getItem("token")},googleMap.removeToken=function(){return window.localStorage.clear()},googleMap.addInfoWindowForIsland=function(e,t,o){var i=this;google.maps.event.addListener(t,"click",function(){"undefined"!=typeof i.infoWindow&&i.infoWindow.close(),i.infoWindow=new google.maps.InfoWindow({content:'\n          <div class="infoWindow">\n          <img class="islandImage" src="../images/'+e.image+'"><p>'+e.name+"</p><p>"+e.location+"</p><p>"+e.area+"</p>\n          <p>"+e.description+"</p>\n          <p>"+o.weather[0].description+"</p>\n          "}),i.infoWindow.open(i.map,t),i.map.setCenter(t.getPosition()),i.map.setZoom(15),google.maps.event.addListener(i.infoWindow,"closeclick",function(){googleMap.map.setZoom(2)})})},googleMap.createMarkerForIsland=function(e){var t=this;$.get("http://api.openweathermap.org/data/2.5/weather?lat="+e.lat+"&lon="+e.lng+"&APPID=fac0994644ce8854830ef0888b428c6d").done(function(o){console.log(o);var i=new google.maps.LatLng(e.lat,e.lng),a=new google.maps.Marker({position:i,map:t.map,animation:google.maps.Animation.DROP,icon:"images/Dagger-1.png"});t.addInfoWindowForIsland(e,a,o)})},googleMap.loopThroughIslands=function(e){$.each(e,function(e,t){setTimeout(function(){googleMap.createMarkerForIsland(t)},400*e)})},googleMap.createMarkerForMonster=function(e){var t=new google.maps.LatLng(e.lat,e.lng);new google.maps.Marker({position:t,map:this.map,icon:e.image})},googleMap.addMonsters=function(e){var t=[{image:"images/bwhale.gif",lat:-53.686319,lng:75.70808},{image:"images/flyingfish.gif",lat:-47.59415,lng:-118.050739},{image:"images/gesseadev.gif",lat:75.304227,lng:37.723388},{image:"images/gesboarwh.gif",lat:55.838049,lng:-88.588684},{image:"images/whayng.gif",lat:-70.686045,lng:-41.620913}];$.each(t,function(e,t){setTimeout(function(){googleMap.createMarkerForMonster(t)},400*e)})},googleMap.getIslands=function(){$.get("http://localhost:3000/api/islands").done(this.loopThroughIslands),this.addMonsters()},googleMap.mapSetup=function(){this.$main.html("<div id='map'></div>");var e=document.getElementById("map"),t={zoom:2,center:new google.maps.LatLng(51.490744,(-.140362)),mapTypeId:google.maps.MapTypeId.ROADMAP,styles:[{featureType:"all",elementType:"all",stylers:[{color:"#d4b78f"},{visibility:"on"}]},{featureType:"all",elementType:"geometry.stroke",stylers:[{color:"#0d0000"},{visibility:"on"},{weight:1}]},{featureType:"administrative",elementType:"labels.text.fill",stylers:[{color:"#98290e"},{visibility:"on"}]},{featureType:"administrative",elementType:"labels.text.stroke",stylers:[{visibility:"off"}]},{featureType:"administrative.province",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"administrative.locality",elementType:"labels.text.fill",stylers:[{color:"#98290e"},{visibility:"on"}]},{featureType:"administrative.locality",elementType:"labels.text.stroke",stylers:[{visibility:"off"}]},{featureType:"administrative.neighborhood",elementType:"all",stylers:[{visibility:"on"}]},{featureType:"landscape",elementType:"all",stylers:[{color:"#d4b78f"},{visibility:"on"}]},{featureType:"poi",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"poi.park",elementType:"all",stylers:[{color:"#c4b17e"},{visibility:"on"}]},{featureType:"road",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{visibility:"off"}]},{featureType:"road.highway",elementType:"labels.text.fill",stylers:[{color:"#0d0000"},{visibility:"on"}]},{featureType:"road.highway",elementType:"labels.text.stroke",stylers:[{color:"#d9be94"},{visibility:"on"}]},{featureType:"road.highway.controlled_access",elementType:"geometry.fill",stylers:[{color:"#0d0000"},{visibility:"off"},{weight:2}]},{featureType:"road.arterial",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"road.local",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#a8ac91"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#60061E"},{visibility:"on"}]},{featureType:"water",elementType:"labels.text.stroke",stylers:[{visibility:"off"}]}]};this.map=new google.maps.Map(e,t),this.getIslands()},$(googleMap.init.bind(googleMap));